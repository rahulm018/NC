<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NC Navigation Hub</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="shared/style.css">
  
  <style id="page-specific-styles"></style>

</head>
<body class="flex flex-col min-h-screen bg-slate-50">

  <header id="header-placeholder"></header>

  <main id="page-content" class="flex-grow w-full">
    <div id="loader" class="hidden flex justify-center items-center h-64">
      <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary-600"></div>
    </div>
  </main>
  
  <footer id="footer-placeholder"></footer>

  <script src="shared/header.js"></script>
  <script src="shared/footer.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pageContent = document.getElementById('page-content');
      const loader = document.getElementById('loader');
      const pageSpecificStyles = document.getElementById('page-specific-styles');

      const pageRoutes = {
        'hub': { isHub: true },
        'listing': { path: 'NC Listing Page.html', containerSelector: '#app-container' },
        'creation': { path: 'NC Creation and Edit Page.html', containerSelector: '.max-w-7xl.mx-auto.bg-white' },
        'copq_mapping': { path: 'CoPQ/Template/Mapping.html', containerSelector: '.container.mx-auto' },
        'view': { html: '<div class="text-center p-16"><h1 class="text-2xl font-bold">NC View Page</h1><p>Content for viewing a specific NC would go here.</p></div>' },
        'dashboard': { html: '<div class="text-center p-16"><h1 class="text-2xl font-bold">Dashboard</h1><p>Content for the dashboard would go here.</p></div>' }
      };

      const executeScripts = (doc) => {
          const scripts = doc.querySelectorAll('script');
          scripts.forEach(script => {
              const newScript = document.createElement('script');
              if (script.src) {
                  newScript.src = script.src;
                  document.body.appendChild(newScript);
                  newScript.onload = () => {
                      // Clean up the script tag once it has loaded to prevent re-execution
                      document.body.removeChild(newScript);
                  };
              } else {
                  // For inline scripts, we can just eval the content
                  eval(script.textContent);
              }
          });
      };

      const loadContent = async () => {
        const hash = window.location.hash.substring(1) || 'hub';
        const route = pageRoutes[hash];
        
        pageContent.innerHTML = '';
        pageSpecificStyles.innerHTML = '';
        loader.classList.remove('hidden');

        if (!route) {
          pageContent.innerHTML = '<div class="text-center p-16"><h1 class="text-2xl font-bold text-red-600">Error 404</h1><p>Page not found.</p></div>';
          loader.classList.add('hidden');
          return;
        }

        if (route.isHub) {
            pageContent.innerHTML = `
                <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">
                  <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight">Module Hub</h2>
                    <p class="mt-4 text-lg text-slate-600">Select a destination to begin your workflow.</p>
                  </div>
                  <div id="hub-sections-container" class="space-y-12"></div>
                </div>
            `;
            generateHubSections(); 
        } else if (route.html) {
            pageContent.innerHTML = route.html;
        } else if (route.path) {
            try {
                const response = await fetch(route.path);
                if (!response.ok) throw new Error(`Could not load page. Status: ${response.status}`);
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const contentNode = doc.querySelector(route.containerSelector);
                const styles = Array.from(doc.querySelectorAll('style'));

                if (contentNode) {
                    pageContent.innerHTML = contentNode.outerHTML;
                    pageSpecificStyles.innerHTML = styles.map(style => style.innerHTML).join('\\n');
                    
                    // Execute the scripts from the fetched page
                    executeScripts(doc);
                } else {
                    throw new Error(`Container selector '${route.containerSelector}' not found in ${route.path}`);
                }
            } catch (error) {
                console.error('Failed to load page:', error);
                pageContent.innerHTML = `<div class="text-center p-16"><h1 class="text-2xl font-bold text-red-600">Error</h1><p>Could not load page content.</p><p class="text-sm text-slate-500 mt-2">${error.message}</p></div>`;
            }
        }
        
        loader.classList.add('hidden');
        updateActiveLinks(hash);
      };

      const updateActiveLinks = (hash) => {
        const allLinks = document.querySelectorAll('.nav-link');
        allLinks.forEach(link => {
          link.classList.remove('active', 'bg-primary-100', 'text-primary-700', 'font-semibold');
          const linkHash = link.getAttribute('href')?.substring(1);
          if (linkHash === hash) {
            link.classList.add('active', 'bg-primary-100', 'text-primary-700', 'font-semibold');
          }
        });
      };
      
      window.addEventListener('hashchange', loadContent);

      document.body.addEventListener('click', (e) => {
          const anchor = e.target.closest('a');
          if (anchor && anchor.getAttribute('href')?.startsWith('#')) {
              e.preventDefault();
              const newHash = anchor.getAttribute('href');
              if (window.location.hash !== newHash) {
                window.location.hash = newHash;
              }
          }
      });
      
      loadContent();
    });
  </script>

</body>
</html>
